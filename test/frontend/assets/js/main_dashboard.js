// OntoTrade Main Dashboard JavaScript

// Ïñ∏Ïñ¥ Ï†ÑÌôò Ìï®Ïàò
function switchLanguage(lang) {
    const elements = document.querySelectorAll('[data-ko][data-en]');
    const placeholderElements = document.querySelectorAll('[data-ko-placeholder][data-en-placeholder]');
    
    elements.forEach(element => {
        if (lang === 'ko') {
            element.textContent = element.getAttribute('data-ko');
        } else {
            element.textContent = element.getAttribute('data-en');
        }
    });
    
    placeholderElements.forEach(element => {
        if (lang === 'ko') {
            element.placeholder = element.getAttribute('data-ko-placeholder');
        } else {
            element.placeholder = element.getAttribute('data-en-placeholder');
        }
    });
    
    // Ïñ∏Ïñ¥ Î≤ÑÌäº ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
    document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    document.querySelector(`[data-lang="${lang}"]`).classList.add('active');
}

// ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ï¥àÍ∏∞Ìôî
document.addEventListener('DOMContentLoaded', function() {
    
    // Ïñ∏Ïñ¥ Ï†ÑÌôò Î≤ÑÌäº Ïù¥Î≤§Ìä∏
    document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const lang = this.getAttribute('data-lang');
            switchLanguage(lang);
        });
    });

    // ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò ÎßÅÌÅ¨ ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏
    document.querySelectorAll('.nav-link').forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            document.querySelector('.nav-link.active')?.classList.remove('active');
            this.classList.add('active');
            
            // ÌòÑÏû¨ Ïñ∏Ïñ¥ ÌôïÏù∏
            const currentLang = document.querySelector('.lang-btn.active').getAttribute('data-lang');
            
            // ÌéòÏù¥ÏßÄ Ï†úÎ™© Î≥ÄÍ≤Ω (Ïñ∏Ïñ¥Î≥Ñ)
            const linkText = this.textContent.trim();
            const panelTitle = document.querySelector('.panel-title');
            
            if (linkText.includes('Ìè¨Ìä∏Ìè¥Î¶¨Ïò§') || linkText.includes('Portfolio')) {
                if (currentLang === 'ko') {
                    panelTitle.textContent = 'üíº Ìè¨Ìä∏Ìè¥Î¶¨Ïò§ Í¥ÄÎ¶¨';
                } else {
                    panelTitle.textContent = 'üíº Portfolio Management';
                }
            } else if (linkText.includes('Î∂ÑÏÑùÎèÑÍµ¨') || linkText.includes('Analytics')) {
                if (currentLang === 'ko') {
                    panelTitle.textContent = 'üìä Ïû¨Î¨¥ Î∂ÑÏÑù ÎèÑÍµ¨';
                } else {
                    panelTitle.textContent = 'üìä Financial Analytics';
                }
            } else if (linkText.includes('Î¶¨ÎçîÎ≥¥Îìú') || linkText.includes('Leaderboard')) {
                if (currentLang === 'ko') {
                    panelTitle.textContent = 'üèÜ Ìà¨ÏûêÏûê Î¶¨ÎçîÎ≥¥Îìú';
                } else {
                    panelTitle.textContent = 'üèÜ Trader Leaderboard';
                }
            } else if (linkText.includes('ÌïôÏäµÏÑºÌÑ∞') || linkText.includes('Learn')) {
                if (currentLang === 'ko') {
                    panelTitle.textContent = 'üìö Ìà¨Ïûê ÌïôÏäµÏÑºÌÑ∞';
                } else {
                    panelTitle.textContent = 'üìö Learning Center';
                }
            } else if (linkText.includes('ÏÑ§Ï†ï') || linkText.includes('Settings')) {
                if (currentLang === 'ko') {
                    panelTitle.textContent = '‚öôÔ∏è Í≥ÑÏ†ï ÏÑ§Ï†ï';
                } else {
                    panelTitle.textContent = '‚öôÔ∏è Settings';
                }
            } else if (linkText.includes('ÎåÄÏãúÎ≥¥Îìú') || linkText.includes('Dashboard')) {
                if (currentLang === 'ko') {
                    panelTitle.textContent = 'Ïï†Ìîå (AAPL) Î∂ÑÏÑù';
                } else {
                    panelTitle.textContent = 'Apple Inc. (AAPL) Analysis';
                }
            }
        });
    });

    // Ïπ¥ÌÖåÍ≥†Î¶¨ ÏïÑÏù¥ÌÖú ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏
    document.querySelectorAll('.category-item:not(.disabled)').forEach(item => {
        item.addEventListener('click', function() {
            // Í∞ôÏùÄ ÏÑπÏÖò ÎÇ¥ÏóêÏÑúÎßå active Ï†úÍ±∞
            const section = this.closest('.category-section');
            section.querySelector('.category-item.active')?.classList.remove('active');
            this.classList.add('active');
        });
    });

    // Î∑∞ Ïª®Ìä∏Î°§ Î≤ÑÌäº Ïù¥Î≤§Ìä∏
    document.querySelectorAll('.control-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            document.querySelector('.control-btn.active')?.classList.remove('active');
            this.classList.add('active');
        });
    });

    // ÌÉ≠ Ïù¥Î≤§Ìä∏
    document.querySelectorAll('.tab').forEach(tab => {
        tab.addEventListener('click', function() {
            document.querySelector('.tab.active')?.classList.remove('active');
            this.classList.add('active');
        });
    });

    // ÌöåÏÇ¨ Ïπ¥Îìú ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏
    document.querySelectorAll('.company-card').forEach(card => {
        card.addEventListener('click', function() {
            const companyName = this.querySelector('.company-name').textContent;
            const symbol = this.querySelector('.stock-symbol').textContent;
            const currentLang = document.querySelector('.lang-btn.active').getAttribute('data-lang');
            
            if (currentLang === 'ko') {
                document.querySelector('.panel-title').textContent = `${companyName} (${symbol}) Î∂ÑÏÑù`;
            } else {
                document.querySelector('.panel-title').textContent = `${companyName} (${symbol}) Analysis`;
            }
        });
    });

    // Í∑∏ÎûòÌîÑ ÎÖ∏Îìú ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏
    document.querySelectorAll('.graph-node').forEach(node => {
        node.addEventListener('click', function() {
            // ÌÅ¥Î¶≠ Ïãú ÏÇ¥Ïßù ÌôïÎåÄ Ìö®Í≥º
            this.style.transform += ' scale(1.1)';
            setTimeout(() => {
                this.style.transform = this.style.transform.replace(' scale(1.1)', '');
            }, 200);
            
            // Ïó∞Í≤∞ÏÑ† ÌïòÏù¥ÎùºÏù¥Ìä∏ Ìö®Í≥º
            document.querySelectorAll('.graph-connection').forEach(conn => {
                conn.style.background = '#3b82f6';
                setTimeout(() => {
                    conn.style.background = '#334155';
                }, 1000);
            });
        });
    });

    // Í≤ÄÏÉâ Í∏∞Îä• (Í∏∞Î≥∏Ï†ÅÏù∏ ÌïÑÌÑ∞ÎßÅ)
    document.querySelector('.search-box').addEventListener('input', function(e) {
        const searchTerm = e.target.value.toLowerCase();
        
        // ÌöåÏÇ¨ Ïπ¥Îìú ÌïÑÌÑ∞ÎßÅ
        document.querySelectorAll('.company-card').forEach(card => {
            const companyName = card.querySelector('.company-name').textContent.toLowerCase();
            const symbol = card.querySelector('.stock-symbol').textContent.toLowerCase();
            
            if (companyName.includes(searchTerm) || symbol.includes(searchTerm)) {
                card.style.display = 'block';
            } else {
                card.style.display = searchTerm === '' ? 'block' : 'none';
            }
        });
    });

    // Ìä∏Î†àÏù¥Îî© Î≤ÑÌäº ÌÅ¥Î¶≠ Ìö®Í≥º
    document.querySelector('.trade-button').addEventListener('click', function() {
        const currentLang = document.querySelector('.lang-btn.active').getAttribute('data-lang');
        
        this.style.background = '#1d4ed8';
        
        if (currentLang === 'ko') {
            this.textContent = 'üíπ Ï≤òÎ¶¨Ï§ë...';
            setTimeout(() => {
                this.style.background = '#3b82f6';
                this.textContent = 'üíπ Í±∞ÎûòÌïòÍ∏∞';
            }, 1500);
        } else {
            this.textContent = 'üíπ Processing...';
            setTimeout(() => {
                this.style.background = '#3b82f6';
                this.textContent = 'üíπ Trade';
            }, 1500);
        }
    });

    // Îâ¥Ïä§ ÏïÑÏù¥ÌÖú Ìò∏Î≤Ñ Ìö®Í≥º
    document.querySelectorAll('.news-item').forEach(item => {
        item.addEventListener('mouseenter', function() {
            this.style.background = '#1e293b';
        });
        
        item.addEventListener('mouseleave', function() {
            this.style.background = '#0f172a';
        });
    });

    // Ìè¨Ìä∏Ìè¥Î¶¨Ïò§ ÏïÑÏù¥ÌÖú Ìò∏Î≤Ñ Ìö®Í≥º
    document.querySelectorAll('.portfolio-item').forEach(item => {
        item.addEventListener('mouseenter', function() {
            this.style.background = '#1e293b';
            this.style.borderRadius = '4px';
            this.style.padding = '10px 8px';
            this.style.margin = '0 -8px';
        });
        
        item.addEventListener('mouseleave', function() {
            this.style.background = 'transparent';
            this.style.borderRadius = '0';
            this.style.padding = '10px 0';
            this.style.margin = '0';
        });
    });

    // Ïã§ÏãúÍ∞Ñ Îç∞Ïù¥ÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏ ÏãúÎÆ¨Î†àÏù¥ÏÖò
    function updateRealTimeData() {
        // Ï£ºÍ∞Ä ÏóÖÎç∞Ïù¥Ìä∏
        const priceElements = document.querySelectorAll('.price');
        priceElements.forEach(element => {
            const currentPrice = parseFloat(element.textContent.replace(', ''));
            const change = (Math.random() - 0.5) * 2; // -1 ~ +1 Îã¨Îü¨ Î≥ÄÎèô
            const newPrice = Math.max(0, currentPrice + change);
            element.textContent = ' + newPrice.toFixed(2);
        });

        // Í∞ÄÍ≤© Î≥ÄÎèôÎ•† ÏóÖÎç∞Ïù¥Ìä∏
        const changeElements = document.querySelectorAll('.price-change');
        changeElements.forEach(element => {
            const isUp = Math.random() > 0.5;
            const changeValue = (Math.random() * 2).toFixed(1); // 0~2% Î≥ÄÎèô
            
            element.textContent = (isUp ? '+' : '-') + changeValue + '%';
            element.className = 'price-change ' + (isUp ? 'price-up' : 'price-down');
        });

        // Ìè¨Ìä∏Ìè¥Î¶¨Ïò§ Í∞í ÏóÖÎç∞Ïù¥Ìä∏
        const portfolioValue = document.querySelector('.portfolio-value');
        if (portfolioValue) {
            const currentValue = parseInt(portfolioValue.textContent.replace(/[‚Ç©,]/g, ''));
            const change = Math.floor((Math.random() - 0.5) * 10000);
            const newValue = currentValue + change;
            portfolioValue.textContent = '‚Ç©' + newValue.toLocaleString();
        }
    }

    // 5Ï¥àÎßàÎã§ Ïã§ÏãúÍ∞Ñ Îç∞Ïù¥ÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏
    setInterval(updateRealTimeData, 5000);

    // ÏÑπÏÖò ÎßÅÌÅ¨ ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏
    document.querySelectorAll('.section-link').forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const linkText = this.textContent;
            console.log('ÏÑπÏÖò ÎßÅÌÅ¨ ÌÅ¥Î¶≠:', linkText);
            // Ïã§Ï†ú Íµ¨ÌòÑ Ïãú Ìï¥Îãπ ÌéòÏù¥ÏßÄÎ°ú Ïù¥Îèô
        });
    });

    // ÌÄµ ÎßÅÌÅ¨ ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏
    document.querySelectorAll('.quick-link').forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const linkText = this.textContent;
            console.log('ÌÄµ ÎßÅÌÅ¨ ÌÅ¥Î¶≠:', linkText);
            // Ïã§Ï†ú Íµ¨ÌòÑ Ïãú Ìï¥Îãπ Í∏∞Îä• Ïã§Ìñâ
        });
    });

    // Î∞∞ÏßÄ ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏
    document.querySelectorAll('.badge').forEach(badge => {
        badge.addEventListener('click', function() {
            const badgeName = this.textContent;
            console.log('Î∞∞ÏßÄ ÌÅ¥Î¶≠:', badgeName);
            // Î∞∞ÏßÄ ÏÉÅÏÑ∏ Ï†ïÎ≥¥ Î™®Îã¨ ÌëúÏãú
        });
    });

    // Îâ¥Ïä§ ÏïÑÏù¥ÌÖú ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏
    document.querySelectorAll('.news-item').forEach(item => {
        item.addEventListener('click', function() {
            const newsTitle = this.querySelector('.news-title').textContent;
            console.log('Îâ¥Ïä§ ÌÅ¥Î¶≠:', newsTitle);
            // Îâ¥Ïä§ ÏÉÅÏÑ∏ ÌéòÏù¥ÏßÄ Ïù¥Îèô
        });
    });

    // ÌÇ§Î≥¥Îìú Îã®Ï∂ïÌÇ§
    document.addEventListener('keydown', function(e) {
        if (e.ctrlKey || e.metaKey) {
            switch(e.key) {
                case '1':
                    e.preventDefault();
                    document.querySelector('.nav-link[data-ko*="ÎåÄÏãúÎ≥¥Îìú"]').click();
                    break;
                case '2':
                    e.preventDefault();
                    document.querySelector('.nav-link[data-ko*="Ìè¨Ìä∏Ìè¥Î¶¨Ïò§"]').click();
                    break;
                case '3':
                    e.preventDefault();
                    document.querySelector('.nav-link[data-ko*="Î∂ÑÏÑùÎèÑÍµ¨"]').click();
                    break;
                case 'l':
                    e.preventDefault();
                    // Ïñ∏Ïñ¥ ÌÜ†Í∏Ä
                    const currentLang = document.querySelector('.lang-btn.active').getAttribute('data-lang');
                    const newLang = currentLang === 'ko' ? 'en' : 'ko';
                    switchLanguage(newLang);
                    break;
                case 'f':
                    e.preventDefault();
                    document.querySelector('.search-box').focus();
                    break;
            }
        }
    });

    // Î∞òÏùëÌòï Î†àÏù¥ÏïÑÏõÉ Ï°∞Ï†ï
    function adjustLayout() {
        const width = window.innerWidth;
        const mainContent = document.querySelector('.main-content');
        
        if (width < 1200) {
            mainContent.style.gridTemplateColumns = '1fr';
            mainContent.style.height = 'auto';
        } else if (width < 1400) {
            mainContent.style.gridTemplateColumns = '250px 1fr 300px';
        } else {
            mainContent.style.gridTemplateColumns = '280px 1fr 320px';
        }
    }

    // ÏúàÎèÑÏö∞ Î¶¨ÏÇ¨Ïù¥Ï¶à Ïù¥Î≤§Ìä∏
    window.addEventListener('resize', adjustLayout);
    adjustLayout(); // Ï¥àÍ∏∞ Ïã§Ìñâ

    // Ïä§ÌÅ¨Î°§ Ïù¥Î≤§Ìä∏ (Î¨¥Ìïú Ïä§ÌÅ¨Î°§ Îì±Ïóê ÌôúÏö©)
    const panels = document.querySelectorAll('.sidebar, .main-panel, .right-panel');
    panels.forEach(panel => {
        panel.addEventListener('scroll', function() {
            // Ïä§ÌÅ¨Î°§ ÏúÑÏπòÏóê Îî∞Î•∏ Ï∂îÍ∞Ä Î°úÏßÅ
            if (this.scrollTop + this.clientHeight >= this.scrollHeight - 10) {
                console.log('Ìå®ÎÑê ÎÅùÏóê ÎèÑÎã¨:', this.className);
                // Ï∂îÍ∞Ä Îç∞Ïù¥ÌÑ∞ Î°úÎìú Îì±
            }
        });
    });

    // Ìà¥ÌåÅ Í∏∞Îä•
    function addTooltips() {
        const tooltipElements = document.querySelectorAll('[data-tooltip]');
        tooltipElements.forEach(element => {
            element.addEventListener('mouseenter', function(e) {
                const tooltip = document.createElement('div');
                tooltip.className = 'tooltip';
                tooltip.textContent = this.getAttribute('data-tooltip');
                tooltip.style.cssText = `
                    position: absolute;
                    background: #1e293b;
                    color: #e2e8f0;
                    padding: 8px 12px;
                    border-radius: 6px;
                    font-size: 12px;
                    white-space: nowrap;
                    z-index: 1000;
                    pointer-events: none;
                    border: 1px solid #334155;
                `;
                document.body.appendChild(tooltip);
                
                const rect = this.getBoundingClientRect();
                tooltip.style.left = rect.left + (rect.width / 2) - (tooltip.offsetWidth / 2) + 'px';
                tooltip.style.top = rect.top - tooltip.offsetHeight - 8 + 'px';
            });
            
            element.addEventListener('mouseleave', function() {
                const tooltip = document.querySelector('.tooltip');
                if (tooltip) {
                    tooltip.remove();
                }
            });
        });
    }

    addTooltips();

    // ÌéòÏù¥ÏßÄ Í∞ÄÏãúÏÑ± Î≥ÄÍ≤Ω Í∞êÏßÄ (ÌÉ≠ Ï†ÑÌôò Ïãú Ïã§ÏãúÍ∞Ñ ÏóÖÎç∞Ïù¥Ìä∏ Ï§ëÏßÄ/Ïû¨Í∞ú)
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            console.log('ÌéòÏù¥ÏßÄÍ∞Ä Î∞±Í∑∏ÎùºÏö¥ÎìúÎ°ú Ïù¥Îèô');
            // Ïã§ÏãúÍ∞Ñ ÏóÖÎç∞Ïù¥Ìä∏ Ï§ëÏßÄ
        } else {
            console.log('ÌéòÏù¥ÏßÄÍ∞Ä Ìè¨Í∑∏ÎùºÏö¥ÎìúÎ°ú Î≥µÍ∑Ä');
            // Ïã§ÏãúÍ∞Ñ ÏóÖÎç∞Ïù¥Ìä∏ Ïû¨Í∞ú
        }
    });

    // Ï¥àÍ∏∞ Î°úÎî© ÏôÑÎ£å Î©îÏãúÏßÄ
    console.log('OntoTrade Î©îÏù∏ ÎåÄÏãúÎ≥¥Îìú Î°úÎî© ÏôÑÎ£å');
    
    // Í∞úÎ∞ú Î™®ÎìúÏóêÏÑúÎßå ÌëúÏãúÎêòÎäî ÎîîÎ≤ÑÍ∑∏ Ï†ïÎ≥¥
    if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
        console.log('Í∞úÎ∞ú Î™®ÎìúÏóêÏÑú Ïã§Ìñâ Ï§ë');
        console.log('ÌÇ§Î≥¥Îìú Îã®Ï∂ïÌÇ§:');
        console.log('- Ctrl+1,2,3: ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò');
        console.log('- Ctrl+L: Ïñ∏Ïñ¥ Ï†ÑÌôò');
        console.log('- Ctrl+F: Í≤ÄÏÉâ Ìè¨Ïª§Ïä§');
    }
});